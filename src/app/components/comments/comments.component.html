<div class="chat-container" #chatContainer>
  <div
    *ngFor="let comment of comments"
    class="message-wrapper"
    [class.incoming]="isClientMessage(comment)"
    [class.outgoing]="!isClientMessage(comment)"
  >
    <div class="message-bubble">
      <i
        [pTooltip]="
          isUnread(comment) ? 'Oznacz jako przeczytany' : 'Oznacz jako ważny'
        "
        tooltipPosition="top"
        class="pi pi-comment comment-icon"
        [ngClass]="
          isUnread(comment) ? 'comment-icon-unread' : 'comment-icon-read'
        "
        (click)="toggleCommentRead(comment.id)"
      ></i>
      <i
        class="pi pi-pencil edit-icon"
        (click)="markCommentToEdit(comment.id)"
        pTooltip="Edytuj"
        tooltipPosition="top"
      ></i>
      <i
        pTooltip="Usuń"
        tooltipPosition="top"
        class="pi pi-trash delete-icon"
        (click)="deleteComment(comment.id)"
      ></i>
      <p
        class="message-text"
        [innerHTML]="parseTextWithLinks(comment.comment) | emojiConvert"
      ></p>
      <span class="timestamp">
        {{ comment.authorName }}, {{ comment.createdAt }}
      </span>
      <div
        class="avatar-wrapper"
        [class.avatar-user]="isClientMessage(comment)"
        [class.avatar-client]="!isClientMessage(comment)"
      >
        <img
          [src]="comment?.avatar || 'assets/images/avatars/default.png'"
          alt="avatar"
          class="avatar-image"
        />
      </div>
    </div>
  </div>
</div>

<div class="new-message-input-wrapper">
  <div class="new-message-all-comments flex-center">
    <div
      class="comment-read-btn flex-center cursor-pointer"
      pTooltip="Oznacz wszystkie jako przeczytane"
      tooltipPosition="top"
      (click)="
        markAllCommentsAsNeedsAttention(false, isUser ? 'client' : 'user')
      "
    >
      <i class="pi pi-comments"></i>
    </div>
    <div
      class="comment-unread-btn flex-center cursor-pointer"
      pTooltip="Oznacz wszystkie jako ważne"
      tooltipPosition="top"
      (click)="
        markAllCommentsAsNeedsAttention(true, isUser ? 'client' : 'user')
      "
    >
      <i class="pi pi-comments"></i>
    </div>
  </div>
  <textarea
    [(ngModel)]="newMessage"
    class="new-message-textarea"
    placeholder="Napisz wiadomość..."
    (input)="adjustTextareaHeight($event)"
    (keyup.enter)="sendComment()"
    rows="1"
    pTextarea
    fluid
    id="new-message"
  ></textarea>
  <div class="new-message-send-btn-wrapper flex-center">
    <button
      class="send-btn"
      (click)="sendComment()"
      [ngClass]="{ disabled: !newMessage }"
    >
      <i class="pi pi-arrow-up send-icon"></i>
    </button>
  </div>
</div>
