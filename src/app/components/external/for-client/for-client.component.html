<app-send-files who="client" (updateFileList)="updateAttachedFiles($event)" />
<app-show-files who="client" (deleteFiles)="onDeleteFile($event)" />

<div class="container" *ngIf="set">
  <div class="header-placeholder"></div>
  <div class="header-background" [class.mobile-sticky]="isMobileSticky">
    <!-- MOBILE MENU -->
    <div
      class="mobile-menu"
      *ngIf="mobileMenuOpen"
      [class.closing]="mobileMenuClosing"
      (click)="$event.stopPropagation()"
    >
      <!-- mobile menu header  -->
      <div class="mobile-menu-header">
        <div class="mobile-menu-actions">
          <!-- SHOW ALL COMMENTS BTN MOBILE-->

          <div class="position-relative">
            <i
              class="pi pi-comments"
              (click)="showAttachedFiles(); toggleMobileMenu()"
            ></i>
            <p-badge
              [value]="getCommentsBadgeValue()"
              [severity]="getCommentsBadgeClass()"
              [pTooltip]="getCommentsTooltipInfo()"
              class="mobile-nr-files"
              badgeSize="small"
            ></p-badge>
          </div>
          <!-- SHOW ATTACHED FILES BTN MOBILE -->
          <div class="position-relative">
            <i
              class="pi pi-cloud"
              (click)="showAttachedFiles(); toggleMobileMenu()"
            ></i>
            <p-badge
              [value]="filesCount"
              [severity]="filesCount === 0 ? 'secondary' : 'contrast'"
              class="mobile-nr-files"
              badgeSize="small"
              [pTooltip]="'Ilość załączonych plików'"
            ></p-badge>
          </div>
          <!-- SEND FILES BTN MOBILE -->
          <div>
            <i
              class="pi pi-paperclip"
              (click)="
                openSendFilesDialog(set.id, set.hash, set.name);
                toggleMobileMenu()
              "
            ></i>
          </div>
        </div>
        <i class="pi pi-times close-icon" (click)="toggleMobileMenu()"></i>
      </div>

      <!-- mobile menu bookmarks -->
      <ul class="mobile-menu-list">
        @for (bookmark of set.bookmarks; track bookmark.id) {
          <li (click)="loadContentForBookmark(bookmark.id); toggleMobileMenu()">
            {{ bookmark.name }}
          </li>
        }
      </ul>
    </div>

    <div class="header">
      <div>
        <div class="header-title-desktop">
          <h3>Witamy w zestawieniu do inwestycji</h3>
          <h1>{{ set.name }}</h1>
        </div>
        <div class="header-title-mobile">{{ set.name }}</div>
      </div>

      <div class="mobile-menu-icon-wrapper" (click)="toggleMobileMenu()">
        <i class="pi pi-bars"></i>
      </div>

      <div class="header-actions-btn">
        <!-- SHOW ALL COMMENTS BTN -->
        <div class="action-btn-wrapper" (click)="showAllComments()">
          <i class="pi pi-comments"></i>
          <p-badge
            [value]="getCommentsBadgeValue()"
            [severity]="getCommentsBadgeClass()"
            [pTooltip]="getCommentsTooltipInfo()"
            class="badge-position"
            badgeSize="large"
          ></p-badge>
          <label> Komentarze </label>
        </div>
        <!-- SHOW ATTACHED FILES BTN  -->
        <div class="action-btn-wrapper" (click)="showAttachedFiles()">
          <i class="pi pi-cloud"></i>
          <p-badge
            [value]="filesCount"
            [severity]="filesCount === 0 ? 'secondary' : 'contrast'"
            class="badge-position"
            badgeSize="large"
            [pTooltip]="'Ilość załączonych plików'"
          ></p-badge>
          <label> Załączone pliki </label>
        </div>
        <!-- SEND FILES BTN  -->
        <div
          class="action-btn-wrapper"
          (click)="openSendFilesDialog(set.id, set.hash, set.name)"
        >
          <i id="upload-icon" class="pi pi-paperclip"></i>
          <label for="upload-icon"> Wgraj swój plik </label>
        </div>
      </div>
    </div>
  </div>

  <div class="set-content">
    <p-tabs [value]="selectedBookmarkId" scrollable>
      <p-tablist>
        @for (bookmark of set.bookmarks; track bookmark.id) {
          <p-tab
            [value]="bookmark.id"
            (click)="loadContentForBookmark(bookmark.id)"
            >{{ bookmark.name }}</p-tab
          >
        }
      </p-tablist>
      <p-tabpanels>
        @for (bookmark of set.bookmarks; track bookmark.id) {
          <p-tabpanel [value]="bookmark.id">
            <div class="mobile-bookmark-name">
              {{ bookmark.name }}
            </div>
            <!-- bookmark = summary -->
            @if (selectedBookmarkId === 1) {
              <app-summary
                [set]="set"
                [positions]="positions"
                (bookmarkSelected)="loadContentForBookmark($event)"
              />
            } @else {
              <!-- other bookmarks -->
              <ng-container *ngIf="selectedBookmarkId === bookmark.id">
                <app-product
                  *ngFor="let position of positionsFromBookmark"
                  [position]="position"
                  [set]="set"
                  (commentsUpdated)="commentsUpdated()"
                >
                </app-product>
              </ng-container>
            }
          </p-tabpanel>
        }
      </p-tabpanels>
    </p-tabs>
  </div>
</div>
