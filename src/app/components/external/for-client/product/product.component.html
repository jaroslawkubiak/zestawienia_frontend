<div class="positions-item">
  <div class="product-lp">{{ position.kolejnosc }}</div>
  <div class="product-img-wrapper">
    <div class="product-img">
      <img
        [src]="position['imageUrl']"
        alt="image"
        *ngIf="position['imageUrl']"
      />
      <i
        class="pi pi-image"
        *ngIf="!position['imageUrl']"
        pTooltip="Brak obrazu"
      ></i>
    </div>
    <!-- ACTION BUTTONS - COMMENTS AND PRODUCT LINK -->
    <div class="position-action-btn">
      <!-- COMMENTS WRAPPER -->
      <div
        class="comments-wrapper product-buttons flex-center"
        pTooltip="Komentarze"
        tooltipPosition="bottom"
        (click)="showComments(position.id)"
      >
        <div class="comments-cell flex-center">
          <i class="pi pi-comments"></i>
          <p-badge
            [value]="getCommentsBadgeValue()"
            [severity]="getCommentsBadgeSeverity()"
            [pTooltip]="getCommentsTooltipInfo()"
            class="comments-badge-position"
            [badgeSize]="isMobile ? 'small' : 'large'"
          ></p-badge>
        </div>
        Komentarze
      </div>
      <!-- PRODUCT LINK WRAPPER -->
      <div
        class="link-wrapper {{
          position.link ? 'cursor-pointer product-buttons flex-center' : ''
        }}"
        pTooltip="Otwórz link do produktu"
        tooltipPosition="bottom"
      >
        @if (position.link) {
          <a
            href="{{ position.link }}"
            class="link flex-center"
            target="_blank"
            rel="noopener noreferrer"
            ><i class="pi pi-link"></i>LINK</a
          >
        }
      </div>
    </div>
  </div>
  <!-- GROUP - PRODUKT PRODUCENT DOSTAWCA-->
  <div class="product-details">
    <!-- PRODUKT -->
    <div
      class="product-group product-group-heigher"
      *ngIf="!isMobile || position.produkt"
    >
      <div class="product-title">PRODUKT</div>
      <div class="product-name">{{ position.produkt }}</div>
    </div>
    <!-- PRODUCENT -->
    <div
      class="product-group product-group-heigher"
      *ngIf="!isMobile || position.producent"
    >
      <div class="product-title">PRODUCENT</div>
      <div class="product-name">{{ position.producent }}</div>
    </div>
    <!-- DOSTAWCA -->
    <div
      class="product-group product-group-heigher"
      *ngIf="!isMobile || position.supplierId"
    >
      <div class="product-title">DOSTAWCA</div>
      <div class="product-name">
        {{ position.supplierId ? position.supplierId["company"] : "" }}
      </div>
    </div>
  </div>
  <!-- GROUP - KOLEKCJA NR KATALOGOWY KOLOR-->
  <div class="product-details">
    <!-- KOLEKCJA -->
    <div
      class="product-group product-group-heigher"
      *ngIf="!isMobile || position.kolekcja"
    >
      <div class="product-title">KOLEKCJA</div>
      <div class="product-name">
        {{ position.kolekcja }}
      </div>
    </div>
    <!-- NR KATALOGOWY -->
    <div
      class="product-group product-group-heigher"
      *ngIf="!isMobile || position.nrKatalogowy"
    >
      <div class="product-title">NR KATALOGOWY</div>
      <div class="product-name">
        {{ position.nrKatalogowy }}
      </div>
    </div>
    <!-- KOLOR -->
    <div
      class="product-group product-group-heigher"
      *ngIf="!isMobile || position.kolor"
    >
      <div class="product-title">KOLOR</div>
      <div class="product-name">
        {{ position.kolor }}
      </div>
    </div>
  </div>
  <!-- GROUP - ILOŚĆ CENA BRUTTO WARTOŚĆ BRUTTO STATUS-->
  <div
    class="product-details product-price"
    [style.margin-bottom]="
      isMobile && position.status?.cssClass ? '60px' : '0px'
    "
  >
    <!-- ILOŚĆ -->
    <div
      class="product-group product-group-price"
      *ngIf="!isMobile || position.ilosc"
    >
      <div class="product-title">ILOŚĆ</div>
      <div class="product-name">
        {{ position.ilosc | number: "1.2-2" }}
      </div>
    </div>
    <!-- CENA BRUTTO -->
    <div
      class="product-group product-group-price"
      *ngIf="!isMobile || position.brutto"
    >
      <div class="product-title">CENA BRUTTO</div>
      <div class="product-name">
        {{
          position.brutto ? (position.brutto | number: "1.2-2") + " PLN" : ""
        }}
      </div>
    </div>
    <!-- WARTOŚĆ BRUTTO -->
    <div
      class="product-group product-group-price"
      *ngIf="!isMobile || position.wartoscBrutto"
    >
      <div class="product-title">WARTOŚĆ BRUTTO</div>
      <div class="product-name">
        {{
          position.wartoscBrutto
            ? (position.wartoscBrutto | number: "1.2-2") + " PLN"
            : ""
        }}
      </div>
    </div>
    <!-- STATUS  -->
    <div
      class="product-group product-status"
      *ngIf="position.status ? position.status.cssClass : ''"
    >
      <div
        class="product-title"
        [class]="!isMobile ? '' : position.status?.cssClass"
      >
        STATUS
      </div>
      <div class="product-name status-wrapper {{ position.status?.cssClass }} ">
        {{ position.status?.label }}
      </div>
    </div>
  </div>
</div>

<p-dialog
  [header]="header"
  [modal]="true"
  [(visible)]="showCommentsDialog"
  (onHide)="onDialogClosed()"
  [style]="{
    width: '70rem',
    height: isMobile ? '100vh' : '',
    borderRadius: '20px',
  }"
  [dismissableMask]="true"
>
  <app-comments
    [comments]="commentsForPosition"
    [positionId]="positionId"
    [set]="set"
    [commentWatcher]="'client'"
    [commentsDialog]="showCommentsDialog"
  />
</p-dialog>
